{
  "name": "rooster-app-final",
  "version": "0.1.12-draad415-smart-trigger",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build --no-lint && node scripts/postbuild.js",
    "start": "HOSTNAME=0.0.0.0 PORT=${PORT:-3000} node .next/standalone/server.js",
    "lint": "next lint"
  },
  "dependencies": {
    "@supabase/auth-helpers-nextjs": "^0.10.0",
    "@supabase/supabase-js": "^2.78.0",
    "canvg": "^2.0.0",
    "date-fns": "^4.1.0",
    "date-fns-tz": "^3.2.0",
    "html2canvas": "^1.4.1",
    "jspdf": "^2.5.1",
    "jspdf-autotable": "^3.8.2",
    "lucide-react": "^0.548.0",
    "next": "^14.2.35",
    "react": "18.3.1",
    "react-dom": "18.3.1",
    "react-hot-toast": "^2.4.1",
    "xlsx": "^0.18.5",
    "zustand": "^5.0.8"
  },
  "devDependencies": {
    "@types/node": "^20",
    "@types/react": "^18",
    "@types/react-dom": "^18",
    "autoprefixer": "^10.4.19",
    "eslint": "^8.57.0",
    "eslint-config-next": "14.2.35",
    "postcss": "^8.4.40",
    "tailwindcss": "^3.4.1",
    "typescript": "^5"
  },
  "engines": {
    "node": ">=20.0.0",
    "npm": ">=10.0.0"
  },
  "_deploy_metadata": {
    "timestamp": "2026-01-13T14:05:00Z",
    "draad": "DRAAD415_SMART_TRIGGER_FIX",
    "version": "0.1.12-draad415-smart-trigger",
    "cache_bust": true,
    "cache_bust_id": "1736776300000",
    "date_now": 1736776300000,
    "railway_trigger": "FORCE_DEPLOYMENT_v13_DRAAD415_X7Y9",
    "deployment_strategy": "smart-variant-lookup-with-trigger-fallback",
    "fixes": [
      "[DRAAD415] KRITIEKE FIX: Smart variant_id lookup met team-aware fallback",
      "PROBLEEM OPGELOST: DRAAD414 trigger verhoogde invulling op ALLE team variants",
      "VOOR FIX: 387 rijen met invulling > 0 (verwacht: 212)",
      "VOOR FIX: Elke dienst telde 3× mee (GRO + ORA + TOT)",
      "VOOR FIX: 342 rijen waar invulling > aantal (logisch onmogelijk)",
      "OPLOSSING Strategy 1: Match employee team + capacity + allowed",
      "OPLOSSING Strategy 2: Match TOT (totaal) variant + capacity + allowed",
      "OPLOSSING Strategy 3: Match ANY variant + capacity + allowed (highest aantal first)",
      "Write-engine doet smart variant_id lookup (async, batch 50)",
      "Database trigger gebruikt variant_id als primary, fallback als secondary",
      "Trigger update ALLEEN de gevonden variant (niet alle teams)",
      "Filter op aantal > 0 en status != 'MAG_NIET'",
      "Voorkomt multiple team updates",
      "Performance: 400-600ms (includes lookups)",
      "VERWACHTE RESULTAAT: ~212 rijen met invulling > 0 (niet 387)",
      "VERWACHTE RESULTAAT: 0 rijen waar invulling > aantal",
      "VERWACHTE RESULTAAT: Team distributie GRO ~80, ORA ~80, TOT ~52",
      "VERWACHTE RESULTAAT: Variant_id coverage > 95%",
      "Cache-bust ID: 1736776300000",
      "Railway random trigger: FORCE_DEPLOYMENT_v13_DRAAD415_X7Y9",
      "Version bump: 0.1.12-draad415-smart-trigger",
      "Timestamp: 2026-01-13T14:05:00Z",
      "Complete browser cache invalidation",
      "Automated Railway deployment trigger",
      "Database trigger SQL in supabase/migrations/draad415_trigger_fix.sql",
      "Data cleanup SQL in supabase/migrations/draad415_data_cleanup.sql",
      "Test suite SQL in supabase/migrations/draad415_tests.sql"
    ],
    "status": "READY_FOR_DEPLOYMENT",
    "deployment_attempt": 13,
    "reason": "Smart variant_id lookup + team-aware trigger voorkomt 3× counting",
    "random_trigger": "X7Y9",
    "verification_required": true,
    "previous_error": "DRAAD414 trigger verhoogde invulling op ALLE team variants (387 i.p.v. 212)",
    "fix_applied": "Smart variant_id lookup in write-engine + team-aware trigger fallback",
    "test_queries": [
      "SELECT COUNT(*) FROM roster_period_staffing_dagdelen WHERE roster_id='[test_roster_id]' AND invulling > 0;",
      "SELECT COUNT(*) FROM roster_period_staffing_dagdelen WHERE roster_id='[test_roster_id]' AND invulling > aantal;",
      "SELECT team, COUNT(*) FILTER (WHERE invulling > 0) as rows, SUM(invulling) as total FROM roster_period_staffing_dagdelen WHERE roster_id='[test_roster_id]' GROUP BY team;",
      "SELECT COUNT(*) FILTER (WHERE roster_period_staffing_dagdelen_id IS NOT NULL) as with_variant_id, COUNT(*) as total FROM roster_assignments WHERE roster_id='[test_roster_id]' AND status=1;"
    ]
  }
}
