# DRAAD 349 C - Architecture Diagram & Data Flow

## Component Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Parent Component (RoosterView)          â”‚
â”‚  - manages roster CRUD                      â”‚
â”‚  - fetches employees, services              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ props:
                  â”‚ - rosterId
                  â”‚ - employees[]
                  â”‚ - serviceTypes[]
                  â”‚
                  â†“
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚      RoosterLayout.tsx (NEW)                â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  â”‚ State Management                       â”‚
     â”‚  â”‚ - roosterData (Map Map)               â”‚
     â”‚  â”‚ - isUpdating (boolean)               â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  â”‚ Functions                             â”‚
     â”‚  â”‚ - fetchRoosterData()                  â”‚
     â”‚  â”‚ - updateServiceCount()               â”‚
     â”‚  â”‚ - calculatePd()                      â”‚
     â”‚  â”‚ - getPdColor()                       â”‚
     â”‚  â”‚ - getTeamTotals()                    â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  â”‚ UI Render                             â”‚
     â”‚  â”‚ - Sticky Header Row                  â”‚
     â”‚  â”‚ - Employee Data Rows                â”‚
     â”‚  â”‚ - Team Totals Footer                â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ onClick: updateServiceCount
                  â”‚ (No reload, optimistic update)
                  â”‚
                  â†“
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚      Supabase                              â”‚
     â”‚  - roster_employee_services table         â”‚
     â”‚  - UPDATE aantal WHERE roster/emp/svc    â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow: "Button Click to UI Update"

```

â–¼ USER ACTION: Click [+] Button
â”‚
â”‚
â†“
â•“â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•“ (0ms)
â•‘  STEP 1: onClick event fires                â•‘
â•‘  - Call: updateServiceCount(empId, svcId)  â•‘
â••â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â••
â”‚
â”‚
â†“
â•“â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•“ (1ms) âš¡ INSTANT
â•‘  STEP 2: Optimistic UI Update              â•‘
â•‘  - Update state: roosterData[emp][svc]++   â•‘
â•‘  - Re-render: teller shows new count       â•‘
â•‘  - Pd color recalculates (green/red)       â•‘
â•‘  - NO page reload, NO spinner              â•‘
â•‘  âœ… USER SEES: "Count updated!"              â•‘
â••â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â••
â”‚
â”‚ (UI is responsive, user happy)
â”‚
â†“
â•“â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•“ (100ms) ğŸ”„ BACKGROUND
â•‘  STEP 3: Database Persist (Async)          â•‘
â•‘  - Call: supabase.from(...).update(...)    â•‘
â•‘  - Send: POST to /rest/v1/...              â•‘
â•‘  - Query: UPDATE aantal WHERE ...          â•‘
â••â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â••
â”‚
â”‚
â†“
â•“â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•“
â•‘  STEP 4: Success Response                  â•‘
â•‘  - Backend: âœ… 200 OK                        â•‘
â•‘  - State: setIsUpdating(false)             â•‘
â•‘  ğŸ’— Database and UI are in sync              â•‘
â••â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â••
â”‚
â”‚
â†“
â•“â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•“
â•‘  ON ERROR:                                 â•‘
â•‘  - Catch exception                         â•‘
â•‘  - Call: fetchRoosterData() [full refresh] â•‘
â•‘  - Revert UI to correct state              â•‘
â•‘  - Log: console.error(...)                 â•‘
â••â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â••

â–¼ TOTAL TIME: <100ms (mostly network latency)
â–¼ RELOAD? NO! Pure React state management
```

---

## State Management Flow

```

â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
â–‘ Initial Load (useEffect)                    â–‘
â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
       â”‚
       â”‚ roosterData: Mapã€ˆã€‰ = initialData || new Map()
       â”‚
       â†“
       â”‚ if (!initialData) fetchRoosterData()
       â”‚
       â†“
       â”‚ SELECT employee_id, service_id, aantal
       â”‚ FROM roster_employee_services
       â”‚
       â†“
       â”‚ Convert array to Map for fast lookup
       â”‚ Mapã€ˆemployee_id â†’ Mapã€ˆservice_id â†’ aantalã€‰ã€‰
       â”‚
       â†“
       â†‘ setRoosterData(newData)


â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
â–‘ On Service Count Update                     â–‘
â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
       â”‚
       â”‚ setIsUpdating(true)
       â”‚
       â†“
       â”‚ newData = new Map(roosterData)  [shallow copy]
       â”‚ newData.get(empId).set(svcId, newCount)
       â”‚ setRoosterData(newData)  âš¡ UI re-renders
       â”‚
       â†“
       â”‚ supabase.from(...).update({...})  [no await]
       â”‚
       â†“
       â”‚ Response comes back (100ms later)
       â”‚ .then() â†’ setIsUpdating(false)
       â”‚ .catch() â†’ fetchRoosterData()  [full refetch]


â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
â–‘ Derived State (re-computed on render)       â–‘
â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
       â”‚
       â”‚ calculatePd(empId)
       â”‚ â†’ Î£(roosterData[empId].get(svcId) * service.dienstwaarde)
       â”‚
       â”‚ getPdColor(empId)
       â”‚ â†’ Pd === Wd ? 'green' : Pd < Wd ? 'red' : 'gray'
       â”‚
       â”‚ getTeamTotals(svcId)
       â”‚ â†’ { totals: Mapã€ˆteam â†’ countã€‰, grandTotal: number }

```

---

## Database Schema Mapping

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SUPABASE TABLES                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  employees
  â”œâ”€ id (uuid, PK)
  â”œâ”€ voornaam (text)
  â”œâ”€ achternaam (text)
  â”œâ”€ team (text)                â†â–”â– Used: Team grouping
  â””â”€ aantalwerkdagen (integer)  â†â–”â– Used: Wd column

  service_types
  â”œâ”€ id (uuid, PK)
  â”œâ”€ code (text)                â†â–”â– Used: Badge label (DDO, DDA)
  â”œâ”€ naam (text)
  â”œâ”€ dienstwaarde (numeric)     â†â–”â– Used: Pd calculation
  â””â”€ kleur (text, hex)          â†â–”â– Used: Cell background

  roster_employee_services
  â”œâ”€ roster_id (uuid, FK)        â†â–”â– Used: Filter by roster
  â”œâ”€ employee_id (uuid, FK)    â†â–”â– Used: Row identifier
  â”œâ”€ service_id (uuid, FK)     â†â–”â– Used: Column identifier
  â”œâ”€ aantal (integer)           â†â–”â– Used: Count display, Pd calc
  â”œâ”€ actief (boolean)           â†â–”â– Used: Filter active only
  â””â”€ updated_at (timestamp)     â†â–”â– Tracked on update

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ QUERY PATTERN                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  SELECT
    res.employee_id,
    res.service_id,
    res.aantal,
    e.voornaam,
    e.achternaam,
    e.team,
    e.aantalwerkdagen,
    st.code,
    st.dienstwaarde,
    st.kleur
  FROM
    roster_employee_services res
    JOIN employees e ON e.id = res.employee_id
    JOIN service_types st ON st.id = res.service_id
  WHERE
    res.roster_id = $rosterId
    AND res.actief = true
  ORDER BY
    e.achternaam, st.code;

  Note: Component does simple select, joins happen in parent
```

---

## Performance Considerations

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OPTIMIZATION TECHNIQUES                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸš¨ Sticky Header (CSS Native)
  css: sticky position top-0
  perf: O(1) - no JavaScript
  impact: ~0ms overhead

ğŸ± Optimistic Updates
  pattern: Update UI instantly, sync DB background
  perf: User sees response <1ms
  tradeoff: Must fallback if error

ğŸ“„ Map-based Data Structure
  lookup: O(1) get(empId).get(svcId)
  vs array: O(n) linear search
  impact: 100x faster for large rosters

ğŸ’« useCallback Memoization
  prevents: updateServiceCount recreates on every render
  perf: Prevents unnecessary function allocations
  deps: [roosterData, rosterId]

ğŸ“‹ Calculated Properties (No Cache)
  calculatePd(empId): recomputes on each render
  note: cost minimal (<1ms for 100 employees)
  benefit: always stays in sync with roosterData

ğŸ“‹ No List Reordering
  impact: all.map() runs every render
  optimization: could add React.memo if needed
  current: fast enough for <500 employees

```

---

## Integration Checklist

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FOR PARENT COMPONENT                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ ] 1. Import component
    import RoosterLayout from '@/components/RoosterBewerking/RoosterLayout';

[ ] 2. Fetch required data
    const employees = await fetchEmployees();
    const serviceTypes = await fetchServiceTypes();

[ ] 3. Render component
    <RoosterLayout
      rosterId={currentRoster.id}
      employees={employees}
      serviceTypes={serviceTypes}
    />

[ ] 4. Test in browser
    - Load page
    - Scroll horizontally (header should stick)
    - Click +/- (should update without reload)
    - Check colors (green/red based on Wd/Pd)

[ ] 5. Deploy to Railway
    git pull origin main
    (auto-builds)

[ ] 6. Verify live
    https://rooster-app-verloskunde.up.railway.app

```

---

## Error Handling Flow

```

             Button Click
                  â”‚
                  â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ updateServiceCount  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”Œ
        â”‚                     â”‚
        â†“                     â†“
    try {}                catch () {}
        â”‚                     â”‚
        â”‚                     â”‚ Log error
        â”ƒ Optimistic           â”ƒ
        â”ƒ Update              â”ƒ fetchRoosterData()
        â”ƒ                     â”ƒ [refetch all]
        â”ƒ Supabase            â”ƒ
        â”ƒ .update()            â”ƒ Reset UI to
        â”ƒ                     â”ƒ correct state
        â”ƒ Success?             â”ƒ
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â””
        â”‚                     â”‚
        â”‚                     â”‚
        â†“                     â†“
   setIsUpdating(false)    setIsUpdating(false)
        â”‚                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â””
                  â”‚
                  â†“
          Done (UI ready for next action)

```

---

## Browser Compatibility

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BROWSER SUPPORT                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Chrome/Edge      88+     âœ… Full support
Firefox          87+     âœ… Full support
Safari           14.1+   âœ… Full support
Mobile           Modern  âœ… iOS/Android

Deps:
- ES6+ (Map, const, arrow functions, template literals)
- CSS sticky positioning
- Fetch API
- React 16.8+ (hooks)

```

---

**Generated by DRAAD 349 C - 24-12-2025**
