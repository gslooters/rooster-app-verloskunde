# DRAAD223 - GREEDY IMPORT CLEANUP EXECUTION

## Executie Datum
2025-12-20 19:17 CET

## Context
Na DRAAD217 hebben we THREE Railway services:
1. **rooster-app-verloskunde** (Next.js + API routes)
2. **Solver2** (OR-Tools solver service) 
3. **Greedy** (FastAPI greedy solver service)

Probleem: Code bevat nog imports naar oude niet-gebruikte solver locaties.

## Correcte Architectuur (DRAAD217)

```
rooster-app-verloskunde/
├── api/
│   └── greedy_solver_wrapper.py ✅ CORRECT
│       └── imports from: src/solver/greedy_engine.py
├── src/
│   └── solver/
│       └── greedy_engine.py ✅ GEBRUIKT DOOR WRAPPER
├── app/
│   └── api/
│       └── roster/
│           └── solve-greedy/
│               └── route.ts ✅ CORRECT (uses GREEDY_SOLVER_URL)
└── backend/
    └── greedy-service/ ❌ OUDE FILES (niet meer gebruikt)
        ├── greedy_solver_v2.py
        ├── solver_api.py (imports greedy_solver_v2)
        └── pairing_integration.py
```

Greedy Service op Railway: Gebruikt eigen interne engine

## BASELINE VERIFICATIE

### ✅ CORRECT IMPORTS
1. `api/greedy_solver_wrapper.py`
   - Importeert: `from src.solver.greedy_engine import GreedyRosteringEngine, SolveResult`
   - Status: **CORRECT** - Dit is de enige file die dit mag doen

2. `app/api/roster/solve-greedy/route.ts`
   - Gebruikt: `process.env.GREEDY_SOLVER_URL`
   - Status: **CORRECT** - Communiceert via HTTP met Railway Greedy service

### ❌ PROBLEMATISCHE IMPORTS
1. `backend/greedy-service/solver_api.py`
   - Import: `from greedy_solver_v2 import GreedySolverV2`
   - Probleem: Dit bestand wordt NIET meer gebruikt (oude lokale service)
   - Actie: **Verplaats naar /archive** met deprecation notice

2. `backend/greedy-service/pairing_integration.py`
   - Bevat mogelijk oude greedy imports
   - Actie: **Analyseren en verplaatsen naar /archive**

## CLEANUP ACTIES

### Fase 1: Analyse Voltooien
- [x] Baseline verificatie van `api/greedy_solver_wrapper.py` ✅
- [x] Baseline verificatie van `app/api/roster/solve-greedy/route.ts` ✅
- [x] Identificatie problematische imports ✅

### Fase 2: Archivering Oude Backend Service
1. Creëer `/archive/backend-greedy-service/` directory
2. Verplaats hele `backend/greedy-service/` naar archive
3. Voeg `DEPRECATED.md` toe met uitleg

### Fase 3: Documentatie Update
1. Update README.md met nieuwe architectuur
2. Update RAILWAY_DEPLOY documentatie
3. Voeg DRAAD223 completion marker toe

### Fase 4: Verificatie
1. Controleer geen broken imports
2. Controleer Railway deployment blijft werken
3. Test `api/greedy_solver_wrapper.py` functionaliteit

## FILES TO MOVE TO ARCHIVE

```bash
backend/greedy-service/
├── greedy_solver_v2.py          → archive/backend-greedy-service/
├── solver_api.py                 → archive/backend-greedy-service/
├── pairing_integration.py        → archive/backend-greedy-service/
├── constraint_validator.py       → archive/backend-greedy-service/
├── test_fase2.py                 → archive/backend-greedy-service/
├── test_fase3.py                 → archive/backend-greedy-service/
├── Dockerfile                    → archive/backend-greedy-service/
├── requirements.txt              → archive/backend-greedy-service/
├── README_FASE3.md               → archive/backend-greedy-service/
├── FASE3_*.md                    → archive/backend-greedy-service/
└── [...alle andere files]        → archive/backend-greedy-service/
```

## FILES TO KEEP

```bash
✅ BEHOUDEN - ACTIEF GEBRUIKT:
api/greedy_solver_wrapper.py      # Wrapper voor lokale tests
src/solver/greedy_engine.py       # Core GREEDY engine
app/api/roster/solve-greedy/route.ts  # Next.js API route

✅ BEHOUDEN - DOCUMENTATIE:
RAILWAY_DEPLOY_217_GREEDY.txt    # Deployment docs
RAILWAY_DEPLOY_217_SOLVER2.txt   # Deployment docs
DRAAD187_FINAL_SUMMARY.md         # Historical docs
.DRAAD-190-SMART-GREEDY-IMPLEMENTATION.md
.DRAAD-191-SOLVER-SWITCH-EXECUTION.md
```

## VERIFICATIE CHECKLIST

- [ ] Geen imports naar `backend/greedy-service/*`
- [ ] Alleen `api/greedy_solver_wrapper.py` importeert `src/solver/greedy_engine.py`
- [ ] `app/api/roster/solve-greedy/route.ts` gebruikt GREEDY_SOLVER_URL
- [ ] Railway Greedy service blijft werken (eigen interne engine)
- [ ] Geen broken imports in codebase
- [ ] Tests blijven werken

## RAILWAY SERVICES STATUS

Na cleanup blijven deze services operationeel:

1. **rooster-app-verloskunde** 
   - Locatie: Root repo
   - Deployment: Railway automatic deploy from main
   - Endpoints: Next.js app + API routes

2. **Solver2** (OR-Tools)
   - Locatie: `/solver2` directory
   - Deployment: Railway service "Solver2"
   - Endpoint: Via SOLVER2_URL env var

3. **Greedy** (FastAPI)
   - Locatie: SEPARATE Railway deployment (not in repo)
   - Deployment: Railway service "Greedy"
   - Endpoint: Via GREEDY_SOLVER_URL env var
   - **BELANGRIJK**: Gebruikt eigen interne engine, NIET `src/solver/greedy_engine.py`

## UITVOERING

Voer uit in volgorde:

```bash
# 1. Creëer archive directory
mkdir -p archive/backend-greedy-service

# 2. Verplaats hele backend/greedy-service
mv backend/greedy-service/* archive/backend-greedy-service/

# 3. Voeg deprecation notice toe
echo "Dit is gearchiveerd na DRAAD223" > archive/backend-greedy-service/DEPRECATED.md

# 4. Commit
git add .
git commit -m "DRAAD223: Archive old backend/greedy-service - moved to archive"

# 5. Deploy test
# Railway blijft exact hetzelfde werken - geen changes aan services
```

## SUCCESS CRITERIA

✅ Success wanneer:
1. Alle imports zijn clean (alleen api/greedy_solver_wrapper.py → src/solver/greedy_engine.py)
2. Geen broken imports in codebase
3. Railway services blijven werken zonder changes
4. Tests blijven groen
5. Documentatie is bijgewerkt

## ROLLBACK PLAN

Als er problemen zijn:
```bash
# Restore from archive
mv archive/backend-greedy-service/* backend/greedy-service/
rmdir archive/backend-greedy-service
git add .
git commit -m "DRAAD223: Rollback - restored backend/greedy-service"
```

---

**DRAAD223 Executie: GESTART 2025-12-20 19:17 CET**

Next: Execute Fase 2 - Archivering
