# ROLLBACK STATUS: DRAAD200

**Date:** 2025-12-17T00:58:00Z  
**Status:** ✅ ROLLBACK COMPLETE  
**Reason:** npm registry EINTEGRITY checksum corruption  

---

## What Happened

### DRAAD200 Attempt
- Goal: Fix incomplete lock file by regenerating via `npm install` in Docker
- Strategy: Theoretically correct
- Result: **FAILED** - Build died with `npm error code EINTEGRITY`

### Root Cause

**NOT a code problem.** Infrastructure issue:

1. **npm registry had CORRUPTED tarballs**
   - 20+ packages had mismatched SHA512 checksums
   - Registry authentication issues
   - Tarballs corrupted during transit

2. **Lock file has INCOMPLETE integrity fields**
   - `npm ci` (with lock) = uses pre-verified hashes
   - `npm install` (no lock) = re-downloads and verifies
   - When `npm install` tried to verify, it hit corrupted registry
   - Build failed immediately

3. **Timing was unlucky**
   - npm notice: "Access token expired or revoked"
   - Multiple tarball corruption warnings
   - Build attempted during registry instability

---

## Rollback Actions

### ✅ Dockerfile Reverted

**BEFORE (DRAAD200):**
```dockerfile
COPY package*.json ./
RUN npm install                              ← REMOVED
RUN npm ci --prefer-offline --no-audit
```

**AFTER (Reverted):**
```dockerfile
COPY package*.json ./
RUN npm ci --prefer-offline --no-audit
```

**Effect:** Will use existing lock file, no re-download attempts

---

### ✅ Cache-Bust File Deleted

**File:** `.cache-bust-draad200.txt` DELETED  
**Effect:** Removes trigger that forced rebuild  

---

### ✅ Status File Created

**File:** `.rollback-status.md` (this file)  
**Effect:** Documents what happened and why  

---

## Expected Result

**When Railway detects these commits:**

1. Dockerfile changed (npm install line removed)
2. Cache-bust file deleted  
3. Railway triggers rebuild
4. Build runs with `npm ci` only
5. Uses existing (incomplete but working) lock file
6. No new downloads attempted
7. **App should be STABLE again** ✅

---

## Important Notes

### The Lock File Problem Remains

```
❌ Still incomplete integrity fields
❌ Not ideal for long-term
✅ But it WORKS as-is (was working before)
```

### DRAAD200 Strategy Was NOT Wrong

```
✅ Idea: npm install to regenerate lock file = CORRECT
✅ Implementation: Add to Dockerfile = CORRECT
❌ Timing: Attempted during registry corruption = BAD LUCK
```

**When registry is stable:** Can retry this approach successfully

---

## Next Steps (When npm Registry Stable)

### Option 1: Proper Lock File Regeneration

```bash
# Locally (when registry healthy):
rm package-lock.json
npm install
# Verify all integrity fields present
git add package-lock.json
git commit -m "Regenerate complete lock file"
git push  # Railway rebuilds with new lock
```

### Option 2: Use npm shrinkwrap

```bash
npm install
npm shrinkwrap
# Creates npm-shrinkwrap.json (higher priority than lock)
git add npm-shrinkwrap.json
git commit -m "Add npm shrinkwrap"
git push
```

---

## Monitoring

### Check npm Registry Status
- https://status.npmjs.org/
- Look for: All systems operational
- No security incidents
- No tarball corruption warnings

### When Safe to Regenerate
- Registry stable for 1+ hour
- No ongoing incidents
- No authentication warnings

---

## Timeline

```
16-12 20:00   Lock file originally corrupted
16-12 20:00   Multiple failed manual restoration attempts
16-12 23:10   FASE 5: Attempted various fixes
16-12 23:50   DRAAD200: Tried npm install strategy (correct approach)
16-12 23:51   Build fails: npm registry corruption exposed
17-12 00:58   ROLLBACK: Reverted to stable state
17-12 ~01:00  Railway rebuild should stabilize app
```

---

## Questions?

**Q: Why didn't DRAAD200 work?**  
A: npm registry was corrupted. Not a code problem.

**Q: Is the lock file bad?**  
A: Incomplete, but was working. Will need regeneration when registry stable.

**Q: When can we retry?**  
A: When npm registry confirmed stable (check status page).

**Q: Should we use different approach?**  
A: No, `npm install` strategy is correct. Just needed healthy registry.

---

**Status:** ✅ Rollback complete, app stabilizing  
**Next:** Monitor and regenerate lock file when safe  
**Last Updated:** 2025-12-17T00:58:00Z
