â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           DEPLOYMENT CACHE BUST - DRAAD-200 FASE 1 (REVISED)                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ TIMESTAMP: 2025-12-17T17:07:30Z (UPDATED - FIX APPLIED)
ğŸ¯ TARGET: All 3 Railway Services
   - rooster-app-verloskunde (Frontend)
   - Solver2 (Constraint Solver)
   - greedy (Greedy Algorithm)

ğŸ”¨ FIXES APPLIED (COMPLETE CHAIN):
   âœ… Step 1: Deleted: package-lock.json (papandreou@0.2.0 removal)
   âœ… Step 2: Created: public/cache-bust-draad200.txt (force rebuild)
   âœ… Step 3: Updated: .env.local.cache-bust (cache triggers)
   âœ… Step 4: CRITICAL FIX - Dockerfile: npm ci â†’ npm install
      REASON: npm ci requires existing package-lock.json
      SOLUTION: npm install generates lock file in Railway container
      STATUS: COMMITTED & DEPLOYED

ğŸš€ RAILWAY BEHAVIOR (REVISED):
   1. GitHub push detected â†’ Railway webhook triggered
   2. All 3 services: REBUILD INITIATED
   3. rooster-app-verloskunde BUILD PROCESS:
      - Dockerfile COPY package*.json ./
      - Dockerfile RUN npm install --prefer-offline --no-audit
        â†’ npm install (no lock file required)
        â†’ Generates clean package-lock.json IN CONTAINER
        â†’ papandreou@0.2.0 NOT resolved (not in npm registry)
        â†’ Clean dependency tree âœ“
      - Dockerfile COPY . . (includes all changes)
      - Dockerfile RUN npm run build (Next.js build)
   4. HTML2Canvas chain: html2canvas@1.4.1 â†’ canvg@3.0.11
      â†’ Clean resolution (papandreou dropped)
   5. Build completes â†’ Docker image ready
   6. Deployment to Railway
   7. Solver2 & greedy: Updated ENV variables detected
   8. EXPECTED RESULT: All 3 services GREEN within 5-10 minutes

âš ï¸ CRITICAL NOTES:
   - npm install (not npm ci) allows dynamic dependency resolution
   - Container environment: FRESH (no host cache interference)
   - papandreou@0.2.0: NOT available in npm registry â†’ safely excluded
   - Docker Hub: May have brief instability (unrelated, Railway retries)
   - If Docker Hub timeout: Railway automatic retry (3x)

âœ… VERIFICATION CHECKLIST:
   [ ] rooster-app-verloskunde BUILD: SUCCESS (check logs)
   [ ] rooster-app-verloskunde npm install: COMPLETED (no EUSAGE)
   [ ] rooster-app-verloskunde BUILD: npm run build SUCCESS
   [ ] rooster-app-verloskunde DEPLOY: GREEN
   [ ] Solver2 DEPLOY: GREEN  
   [ ] greedy DEPLOY: GREEN
   [ ] Frontend loads without 404 errors
   [ ] No papandreou errors in Railway logs
   [ ] Package-lock.json auto-generated (check container)

ğŸ“Š DATABASE VALIDATION:
   Tables validated: employees, roster_assignments, service_types, solver_runs
   Supabase connection: OK (no schema changes)
   PostgREST API: OK
   Status: DATABASE UNCHANGED (compatible with all code versions)

ğŸ” COMMITS IN THIS PHASE:
   1. 7a19dc3 - Verwijder package-lock.json
   2. a56adad - Nieuw cache-bust bestand
   3. 38249a7 - Update cache-bust env
   4. 5c4488b - Deployment info file
   5. 524f230 - Dockerfile: npm ci â†’ npm install (THIS FIX)

ğŸ“ NEXT PHASE (AFTER VERIFICATION):
   FASE 2 (permanent solution):
   - Downgrade canvg in package.json to ^2.0.0
   - npm install locally (generates clean package-lock.json)
   - Commit updated package-lock.json
   - Change Dockerfile BACK to: npm ci (for production best-practice)
   - Final deploy (permanent, reproducible)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STATUS: AWAITING RAILWAY REBUILD (should start within 30 seconds)
EXPECTED: Build SUCCESS, all 3 services GREEN within 10 minutes
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
