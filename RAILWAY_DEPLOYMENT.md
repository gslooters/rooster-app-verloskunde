# Railway Deployment Instructies - Python Solver Service\n\n## ğŸ¯ DOEL\n\nPython OR-Tools Solver Service toevoegen aan bestaand Railway project.\n\n---\n\n## âœ… WAT AL KLAAR IS\n\n- âœ… Python solver code (`solver/main.py`)\n- âœ… FastAPI REST API met CORE 3 constraints\n- âœ… Dependencies (`solver/requirements.txt`)\n- âœ… Railway config (`solver/Procfile`, `solver/railway.json`)\n- âœ… Code gepushed naar GitHub main branch\n\n**Commits**:\n- `5a4aecd` - Solver service files\n- `c318017` - Railway config + README\n- `3bff1ff` - Deployment trigger\n\n---\n\n## ğŸš€ STAPPEN IN RAILWAY DASHBOARD\n\n### STAP 1: Maak Nieuwe Service aan\n\n1. **Ga naar Railway project** `roostervarw1`\n2. **Klik op \"+\" (New)** (rechtsboven of linksboven)\n3. **Selecteer**: \"GitHub Repo\"\n4. **Kies repository**: `gslooters/rooster-app-verloskunde`\n5. **Klik Deploy**\n\n---\n\n### STAP 2: Configureer Service Settings\n\n**Railway zal automatisch detecteren dat dit een Python project is.**\n\n**Ga naar de nieuwe service â†’ Settings:**\n\n#### A. Root Directory\n```\nRoot Directory: solver\n```\n**Dit is CRUCIAAL - vertelt Railway om alleen `solver/` directory te deployen.**\n\n#### B. Start Command (optioneel, Procfile zou moeten werken)\nAls Railway niet automatisch start command detecteert:\n```\nuvicorn main:app --host 0.0.0.0 --port ${PORT:-8000}\n```\n\n#### C. Build Command (optioneel)\n```\npip install -r requirements.txt\n```\n\n---\n\n### STAP 3: Generate Public URL\n\n1. **Ga naar service â†’ Settings â†’ Networking**\n2. **Klik \"Generate Domain\"**\n3. **Kopieer de gegenereerde URL**\n   - Ziet eruit als: `https://rooster-solver-production.up.railway.app`\n\n---\n\n### STAP 4: Test Solver Service\n\n**Open in browser**:\n```\nhttps://[jouw-solver-url].railway.app/\n```\n\n**Verwachte response**:\n```json\n{\n  \"service\": \"Rooster Solver Service\",\n  \"status\": \"online\",\n  \"version\": \"1.0.0\",\n  \"solver\": \"Google OR-Tools CP-SAT\"\n}\n```\n\n**Test health endpoint**:\n```\nhttps://[jouw-solver-url].railway.app/health\n```\n\n---\n\n### STAP 5: Configureer Next.js App\n\n**Ga naar Next.js service (`rooster-app-verloskunde`) â†’ Variables tab:**\n\n**Voeg toe**:\n```\nSOLVER_SERVICE_URL=https://[jouw-solver-url].railway.app\n```\n\n**Vervang `[jouw-solver-url]` met de URL uit Stap 3!**\n\n---\n\n### STAP 6: Redeploy Next.js Service\n\n**Na environment variable toevoegen**:\n1. Railway zal **automatisch redeployen**\n2. Of: Ga naar Deployments â†’ Klik \"Redeploy\"\n\n---\n\n## âœ… VERIFICATIE\n\n### Check 1: Solver Service Draait\n```bash\ncurl https://[solver-url]/health\n```\n\n**Verwacht**: `{\"status\": \"healthy\", ...}`\n\n### Check 2: Next.js Kan Solver Bereiken\n```bash\n# Check Next.js logs na ORT start\n# Moet zien: \"Solver request voorbereid, aanroepen https://...\"\n```\n\n### Check 3: End-to-End ORT Test\n1. Ga naar dashboard\n2. Klik \"Roosterbewerking starten\"\n3. Check logs in BEIDE services:\n   - **Next.js**: \"Solver request voorbereid\"\n   - **Python Solver**: \"[Solver] Start solving roster...\"\n\n---\n\n## ğŸ“¦ PROJECT ARCHITECTUUR NA DEPLOYMENT\n\n```\nRailway Project: roostervarw1\nâ”œâ”€â”€ Service 1: rooster-app-verloskunde (Next.js)\nâ”‚   â”œâ”€â”€ Port: 8080\nâ”‚   â”œâ”€â”€ URL: rooster-app-verloskunde-production.up.railway.app\nâ”‚   â””â”€â”€ Env Vars:\nâ”‚       â””â”€â”€ SOLVER_SERVICE_URL=https://solver-xyz.railway.app\nâ”‚\nâ””â”€â”€ Service 2: rooster-solver (Python)  â† NIEUW\n    â”œâ”€â”€ Port: 8000\n    â”œâ”€â”€ URL: rooster-solver-production.up.railway.app\n    â”œâ”€â”€ Root: solver/\n    â””â”€â”€ Stack: Python + FastAPI + OR-Tools\n```\n\n---\n\n## ğŸ’¡ TROUBLESHOOTING\n\n### Problem: \"Build failed\"\n**Oplossing**: Check Railway logs\n- Verify `solver/requirements.txt` correct is\n- Check Python versie (Railway gebruikt 3.11 standaard)\n\n### Problem: \"Service crashed\"\n**Oplossing**: Check Runtime logs\n- Verify port binding: `--port ${PORT}`\n- Check OR-Tools import errors\n\n### Problem: \"Next.js kan solver niet bereiken\"\n**Oplossing**:\n1. Verify `SOLVER_SERVICE_URL` is correct gezet\n2. Check of solver service public URL heeft\n3. Test solver URL handmatig in browser\n\n### Problem: \"CORS errors\"\n**Oplossing**: Solver heeft CORS middleware\n- Check dat Next.js URL is toegestaan\n- Temporary: `allow_origins=[\"*\"]` is al gezet\n\n---\n\n## ğŸ“Š KOSTEN INSCHATTING\n\n**Railway Pro Plan**: $20/maand (heb je al)\n\n**Extra Usage voor Solver Service**:\n- **Idle**: ~$2-5/maand (minimale resources als niet actief gebruikt)\n- **Actief gebruik**: ~$5-15/maand\n  - Afhankelijk van:\n    - Hoe vaak ORT wordt gedraaid\n    - Hoe lang solves duren\n    - Hoeveel CPU/RAM gebruikt wordt\n\n**Totaal verwacht**: $20-35/maand (basis + beide services)\n\n---\n\n## ğŸ¯ SUCCESS CRITERIA\n\nâœ… Solver service is **ONLINE** (health endpoint werkt)\nâœ… Solver service heeft **PUBLIC URL**\nâœ… Next.js service heeft **SOLVER_SERVICE_URL** gezet\nâ˜… Next.js service kan **CONNECTEN** met solver\nâœ… ORT call werkt **END-TO-END**\nâœ… Constraints worden **TOEGEPAST** (check logs)\nâ˜… Oplossing wordt **TERUGGESCHREVEN** naar database\n\n---\n\n## ğŸ“¢ VOLGENDE STAPPEN NA DEPLOYMENT\n\n1. **Test met echte data** (bestaand roster)\n2. **Monitor performance** (solve times)\n3. **Tune constraints** indien nodig\n4. **Implement extra constraints** (nacht constraints, team balans, etc.)\n5. **Add monitoring/alerts** in Railway\n\n---\n\n**Klaar om te beginnen? Start bij STAP 1!** ğŸš€\n