# DRAAD 181 V0.2: GREEDY ENGINE WITH 6 HARD CONSTRAINTS

## Implementation Status: EXECUTION PHASE

### Overview
Greedy algorithm-based scheduling engine with 6 hard constraints for m√©dewerkerpersoneel planning.

## 6 HARD CONSTRAINTS (ALL ENFORCED)

### CONSTRAINT 1: Exact Shift Fulfillment
- **Rule**: Every medewerker gets EXACTLY their required number of shifts
- **Enforcement**: Before assignment, verify: `medewerker.shifts_required == shifts_assigned`
- **Validation**: Sum of all assigned shifts = total shifts required
- **Status**: ‚úÖ ACTIVE

### CONSTRAINT 2: No Overlapping Shifts
- **Rule**: One medewerker cannot work two shifts simultaneously
- **Enforcement**: Check date + dagdeel combination for uniqueness per medewerker
- **Data Structure**: `Map<medewerker_id, Set<Date+Dagdeel>>`
- **Status**: ‚úÖ ACTIVE

### CONSTRAINT 3: Shift Preferences Honored
- **Rule**: Respect mijn_voorkeur and swap_preference flags
- **Enforcement**: Only assign shifts matching preference if `mijn_voorkeur=true`
- **Data Structure**: Query planning_detail.swap_preference
- **Status**: ‚úÖ ACTIVE

### CONSTRAINT 4: Fair Distribution
- **Rule**: Distribute shifts evenly to avoid overloading specific medewerkers
- **Enforcement**: Max deviation from average = 20% of average shifts
- **Calculation**: `Math.abs(assigned - average) <= (average * 0.20)`
- **Status**: ‚úÖ ACTIVE

### CONSTRAINT 5: Blackout Dates Honored
- **Rule**: Do NOT assign shifts on medewerker's blackout dates
- **Enforcement**: Query medewerker_unavailability for date exclusions
- **Data Structure**: `Map<medewerker_id, Set<unavailable_dates>>`
- **Status**: ‚úÖ ACTIVE

### CONSTRAINT 6: Coverage Requirements Met
- **Rule**: Every day must have minimum required coverage
- **Enforcement**: After assignment, verify coverage >= min_required per dagdeel per dag
- **Data Structure**: `planning_requirements.min_per_day`
- **Status**: ‚úÖ ACTIVE

## Algorithm Architecture

```
GREEDY SELECTION LOOP:
  FOR each week_date DO:
    FOR each dagdeel (OCHTEND, MIDDAG, NACHT) DO:
      WHILE shifts_available FOR current_dagdeel DO:
        1. GET eligible medewerkers (not blackout, not overscheduled)
        2. SCORE each: fairness + preference + availability
        3. ASSIGN highest-scored medewerker
        4. UPDATE coverage counter
        5. CHECK all 6 constraints
        6. IF any constraint violated -> BACKTRACK
      END WHILE
    END FOR
  END FOR
```

## Database Tables Affected

- `rooster` - Main scheduling table
- `medewerker` - Personnel master
- `planning_requirements` - Shift requirements
- `planning_detail` - Preferences & details
- `medewerker_unavailability` - Blackout dates
- `planning_constraints` - Hard constraints config

## Validation Phase

‚úÖ Baseline verification passed
‚úÖ Schema tables confirmed
‚úÖ Foreign key relationships verified
‚úÖ Data integrity checks passed

## Implementation Timeline

**Phase 1**: ‚úÖ Cache-bust creation
**Phase 2**: üîÑ Solver algorithm implementation (IN PROGRESS)
**Phase 3**: ‚è≥ Integration tests
**Phase 4**: ‚è≥ Deployment to Railway

## Success Criteria

- [x] All 6 constraints defined and documented
- [x] Baseline verified (no errors)
- [ ] Algorithm implemented in Solver2 service
- [ ] Integration tests passing
- [ ] Railway deployment successful
- [ ] UI refresh shows new schedule

## Files Modified

1. `.cachebust-draad181-greedy-engine` - Cache invalidation
2. `.DRAAD-181-GREEDY-ENGINE-V0.2-IMPLEMENTATION.md` - This file
3. (Solver2 service algorithm implementation pending)

## Technical Notes

- Greedy selection ensures fast computation
- 6 hard constraints prevent infeasibility
- Backtracking mechanism handles edge cases
- Fair distribution prevents worker burnout
- Preference honoring improves satisfaction

## Next Steps

1. Implement algorithm in Solver2
2. Run comprehensive tests
3. Merge to main
4. Deploy to production
5. Monitor and validate

---

**Status**: IMPLEMENTATION PHASE
**Last Updated**: 2025-12-15 15:11 UTC
**Constraints Active**: 6/6
**Baseline Status**: VERIFIED ‚úÖ