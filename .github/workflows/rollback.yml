name: Rollback naar commit 9b28413

on:
  workflow_dispatch:      # Handmatig starten
  push:
    branches: [main]      # Optioneel, voorkomt dubbele runs

jobs:
  rollback:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout main
      uses: actions/checkout@v4
      with:
        fetch-depth: 0    # Hele geschiedenis nodig

    - name: Reset naar commit 9b28413
      run: |
        git reset --hard 9b28413
        echo "// cache-bust $(date +%s)" >> src/cache-bust.js

    - name: Commit en push rollback
      run: |
        git config --global user.email "github-actions[bot]@users.noreply.github.com"
        git config --global user.name "github-actions[bot]"
        git add .
        git commit -m "DRAAD ROLLBACK: restore repo to 9b28413"
        git push origin main
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    - name: Health-check live app
      run: |
        curl -f https://rooster-app-verloskunde-production.up.railway.app|| exit 1
