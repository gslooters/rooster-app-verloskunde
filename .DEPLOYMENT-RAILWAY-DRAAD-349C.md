# DRAAD 349 C - Railway Deployment Instructions

**Status:** Ready for deployment
**GitHub:** ✅ All changes pushed
**Railway:** Ready for manual pull

---

## Quick Deployment Steps

### 1. Access Railway Console

```bash
Project: rooster-app-verloskunde
URL: https://railway.app/project/90165889-1a50-4236-aefe-b1e1ae44dc7f
```

### 2. Git Pull in Railway

**Option A: Via Railway CLI**
```bash
railway login
railway link
railway up  # Auto-builds and deploys
```

**Option B: Via Web Console**
- Go to Railway Dashboard
- Select project: `rooster-app-verloskunde`
- Click "Deploy" or "Pull from GitHub"
- Select branch: `main`
- Confirm deploy

**Option C: Manual SSH**
```bash
cd /app
git pull origin main
npm run build
npm start
```

### 3. Verify Deployment

Once build completes:

```bash
# Check service health
curl https://rooster-app-verloskunde.up.railway.app/health

# Expected: 200 OK
```

### 4. Live Verification

Open in browser:
```
https://rooster-app-verloskunde.up.railway.app
```

Check:
- [ ] Page loads without errors
- [ ] Rooster/schedule page accessible
- [ ] Sticky header visible when scrolling
- [ ] Service buttons respond to clicks
- [ ] No full page reload on button click
- [ ] Pd colors display correctly (green/red)
- [ ] Team totals visible at bottom

---

## What Changed (Deployment Impact)

### New Files

```
/src/components/RoosterBewerking/RoosterLayout.tsx  (NEW)
/public/cache-bust-draad349c.json                   (NEW)
```

### Modified Files

None - RoosterLayout is new component, not replacing existing

### Potential Integration Points

Parent component needs to import RoosterLayout:

```typescript
import RoosterLayout from '@/components/RoosterBewerking/RoosterLayout';
```

Then render:

```tsx
<RoosterLayout
  rosterId={rosterId}
  employees={employees}
  serviceTypes={services}
/>
```

---

## Build Configuration

### Next.js Build

```bash
# Automatic on Railway
npm run build
```

**Notes:**
- Component uses `'use client'` - client-side only
- TypeScript: strict mode
- Tailwind: should be configured in project

### Environment Variables

**Required (should already exist):**
```
NEXT_PUBLIC_SUPABASE_URL=...
NEXT_PUBLIC_SUPABASE_ANON_KEY=...
REACT_APP_GREEDY_ENDPOINT=...
```

**New (optional for cache busting):**
```
DEPLOYMENT_CACHE_BUST=<random_string>
```

---

## Troubleshooting

### Issue: "RoosterLayout not found"

**Cause:** Component not imported in parent

**Fix:** Add import statement in parent component:
```typescript
import RoosterLayout from '@/components/RoosterBewerking/RoosterLayout';
```

### Issue: "Supabase connection failed"

**Cause:** Missing env variables in Railway

**Fix:** 
1. Go to Railway Dashboard
2. Select project
3. Click "Variables"
4. Verify:
   - `NEXT_PUBLIC_SUPABASE_URL`
   - `NEXT_PUBLIC_SUPABASE_ANON_KEY`
5. Redeploy

### Issue: "Sticky header not working"

**Cause:** CSS not compiled

**Fix:** 
1. Hard refresh browser: `Ctrl+Shift+Delete` (cache clear)
2. Or check: Cache bust is `${Date.now()}`
3. Check browser dev console for CSS errors

### Issue: "Buttons don't respond / Page reloads"

**Cause:** Old component still loaded

**Fix:**
1. Clear browser cache
2. Hard refresh: `Ctrl+F5`
3. Open new incognito window
4. Check browser console for errors

### Issue: "Color display wrong for services"

**Cause:** `service.kleur` not loading from Supabase

**Fix:**
1. Verify `service_types` table has `kleur` column
2. Check data: `SELECT code, kleur FROM service_types LIMIT 5;`
3. Ensure color format: hex codes like `#FF5733`

---

## Monitoring

### Railway Logs

```bash
railway logs
```

**Look for:**
- `✅ Updated [id] [service] to [count]` - Success logs
- `❌ Fout bij update:` - Error logs
- Build output messages

### Application Metrics

- CPU usage: Should stay <30%
- Memory: <256MB for Next.js app
- Response times: <500ms

---

## Rollback Plan

If something breaks:

```bash
# Option 1: Revert last commit
git revert HEAD
git push origin main
# Railway auto-redeploys

# Option 2: Force old version
git checkout <previous_commit_hash>
git push --force origin main

# Option 3: Disable component (quickest)
# Comment out RoosterLayout import in parent
# Commit and push
```

---

## Post-Deployment Verification Checklist

- [ ] Application loads without 500 errors
- [ ] Rooster view accessible
- [ ] Header sticky when scrolling
- [ ] Service count buttons clickable
- [ ] No console errors in dev tools
- [ ] Pd column shows correct calculations
- [ ] Green color when Pd = Wd
- [ ] Red color when Pd < Wd
- [ ] Team totals row appears
- [ ] No full page reload on button click
- [ ] Cache bust working (network tab shows unique URLs)
- [ ] Mobile responsive (test on tablet width)

---

## Timeline

```
2025-12-24 10:16 - RoosterLayout.tsx committed
2025-12-24 10:16 - Cache bust file created
2025-12-24 10:17 - Technical docs written
2025-12-24 10:17 - Deployment instructions created
              ↓
         [MANUAL STEP]
         Pull on Railway
         Wait ~2-3 min for build
         Verify in browser
```

---

## Support & Questions

**If deployment fails:**
1. Check Railway logs: `railway logs`
2. Check Node version: `node --version`
3. Check npm version: `npm --version`
4. Try rebuild: Click "Redeploy" in Railway dashboard

**GitHub Repository:**
```
https://github.com/gslooters/rooster-app-verloskunde
Branch: main
Commit: 272190ffc8bed33208436776d9f1a68253cbc72a (RoosterLayout.tsx)
```

---

## Success Criteria
✅ **You know deployment is successful when:**

1. No 500 errors on page load
2. Sticky header visible and functional
3. Click +/- buttons: counter updates without page reload
4. Pd column shows green (if balanced) or red (if short)
5. Browser network tab shows updated assets (cache busted)
6. No JavaScript errors in console

**Estimated time:** 5-10 minutes

---

**Last Updated:** 2025-12-24  
**Deployed By:** AI Assistant (DRAAD 349 C)  
**Status:** Ready for Production Deploy ✅
